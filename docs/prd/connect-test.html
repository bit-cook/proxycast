<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ProxyCast Connect æµ‹è¯•é¡µé¢</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { color: white; text-align: center; margin-bottom: 10px; font-size: 2rem; }
    .subtitle { color: rgba(255,255,255,0.8); text-align: center; margin-bottom: 40px; }
    .tabs {
      display: flex; gap: 8px; margin-bottom: 24px;
      background: rgba(255,255,255,0.1); padding: 8px; border-radius: 12px;
    }
    .tab {
      flex: 1; padding: 12px 20px; border: none; border-radius: 8px;
      font-size: 0.95rem; font-weight: 600; cursor: pointer;
      background: transparent; color: rgba(255,255,255,0.7); transition: all 0.2s;
    }
    .tab.active { background: white; color: #667eea; }
    .tab:hover:not(.active) { background: rgba(255,255,255,0.1); color: white; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .card {
      background: white; border-radius: 16px; padding: 30px;
      margin-bottom: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    .card-title {
      font-size: 1.25rem; font-weight: 600; margin-bottom: 20px; color: #1a1a2e;
      display: flex; align-items: center; gap: 10px;
    }
    .card-title::before {
      content: ''; width: 4px; height: 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 2px;
    }
    .form-group { margin-bottom: 20px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 600px) { .form-row { grid-template-columns: 1fr; } }
    label { display: block; font-weight: 500; margin-bottom: 8px; color: #374151; }
    .label-hint { font-weight: normal; color: #9ca3af; font-size: 0.85rem; }
    input, select {
      width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb;
      border-radius: 10px; font-size: 1rem; transition: border-color 0.2s;
    }
    input:focus, select:focus { outline: none; border-color: #667eea; }
    .btn {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 14px 28px; border: none; border-radius: 10px;
      font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s;
    }
    .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); }
    .btn-secondary { background: #f3f4f6; color: #374151; }
    .btn-secondary:hover { background: #e5e7eb; }
    .btn-group { display: flex; gap: 12px; flex-wrap: wrap; }

    .result-box {
      background: #f8fafc; border: 2px dashed #e2e8f0;
      border-radius: 10px; padding: 20px; margin-top: 20px;
    }
    .result-box.success { background: #ecfdf5; border-color: #10b981; border-style: solid; }
    .result-label { font-size: 0.875rem; color: #64748b; margin-bottom: 8px; }
    .result-url {
      font-family: 'Monaco', 'Menlo', monospace; font-size: 0.875rem;
      word-break: break-all; color: #1e293b; background: white;
      padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0;
    }
    .quick-test {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px; margin-top: 20px;
    }
    .quick-test-btn {
      padding: 16px; background: #f8fafc; border: 2px solid #e2e8f0;
      border-radius: 12px; cursor: pointer; transition: all 0.2s; text-align: left;
    }
    .quick-test-btn:hover { border-color: #667eea; background: #f0f4ff; }
    .quick-test-btn .name { font-weight: 600; color: #1a1a2e; margin-bottom: 4px; }
    .quick-test-btn .desc { font-size: 0.875rem; color: #64748b; }
    .tips {
      background: #fffbeb; border: 1px solid #fcd34d;
      border-radius: 10px; padding: 16px; margin-top: 20px;
    }
    .tips.info { background: #eff6ff; border-color: #3b82f6; }
    .tips-title { font-weight: 600; color: #92400e; margin-bottom: 8px; }
    .tips.info .tips-title { color: #1d4ed8; }
    .tips-content { font-size: 0.875rem; color: #a16207; line-height: 1.6; }
    .tips.info .tips-content { color: #1e40af; }
    .log-container {
      max-height: 300px; overflow-y: auto; background: #1a1a2e;
      border-radius: 10px; padding: 16px; margin-top: 16px;
    }
    .log-entry {
      font-family: 'Monaco', 'Menlo', monospace; font-size: 0.8rem;
      color: #a0aec0; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #2d3748;
    }
    .log-entry:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
    .log-entry .time { color: #718096; }
    .log-entry .type { padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; margin: 0 8px; }
    .log-entry .type.info { background: #3182ce; color: white; }
    .log-entry .type.success { background: #38a169; color: white; }
    .log-entry .type.error { background: #e53e3e; color: white; }
    .log-entry .message { color: #e2e8f0; }
    .toast {
      position: fixed; bottom: 20px; right: 20px; background: #1a1a2e;
      color: white; padding: 12px 20px; border-radius: 8px;
      opacity: 0; transform: translateY(20px); transition: all 0.3s; z-index: 1000;
    }
    .toast.show { opacity: 1; transform: translateY(0); }
    .toast.success { background: #10b981; }
    .toast.error { background: #ef4444; }
    .status-badge {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 500;
    }
    .status-badge.success { background: #dcfce7; color: #166534; }
    .status-badge.cancelled { background: #fef3c7; color: #92400e; }
    .status-badge.error { background: #fee2e2; color: #991b1b; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”— ProxyCast Connect æµ‹è¯•</h1>
    <p class="subtitle">æ¨¡æ‹Ÿä¸­è½¬å•†åå°çš„ä¸€é”®é…ç½®åŠŸèƒ½ & Webhook å›è°ƒæµ‹è¯•</p>
    
    <div class="tabs">
      <button class="tab active" onclick="switchTab('deeplink')">ğŸš€ Deep Link æµ‹è¯•</button>
      <button class="tab" onclick="switchTab('webhook')">ğŸ“¤ Webhook å›è°ƒ</button>
      <button class="tab" onclick="switchTab('docs')">ğŸ“– ä½¿ç”¨è¯´æ˜</button>
    </div>

    <!-- Deep Link æµ‹è¯•æ ‡ç­¾é¡µ -->
    <div id="tab-deeplink" class="tab-content active">
      <div class="card">
        <h2 class="card-title">è‡ªå®šä¹‰æµ‹è¯•</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="relay">ä¸­è½¬å•† ID (relay) <span class="label-hint">å¿…å¡«</span></label>
            <input type="text" id="relay" placeholder="ä¾‹å¦‚: openrouter" value="openrouter">
          </div>
          <div class="form-group">
            <label for="key">API Key <span class="label-hint">å¿…å¡«</span></label>
            <input type="text" id="key" placeholder="ä¾‹å¦‚: sk-or-v1-xxxx" value="sk-test-1234567890">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="name">Key åç§° <span class="label-hint">å¯é€‰</span></label>
            <input type="text" id="name" placeholder="ä¾‹å¦‚: æˆ‘çš„ä¸»è´¦å·" value="æµ‹è¯•Key">
          </div>
          <div class="form-group">
            <label for="ref">æ¨å¹¿ç  <span class="label-hint">å¯é€‰ï¼Œç”¨äºç»Ÿè®¡</span></label>
            <input type="text" id="ref" placeholder="ä¾‹å¦‚: promo2024">
          </div>
        </div>
        <div class="btn-group">
          <button class="btn btn-primary" onclick="openDeepLink()">ğŸš€ ä¸€é”®é…ç½® ProxyCast</button>
          <button class="btn btn-secondary" onclick="generateLink()">ğŸ“‹ ç”Ÿæˆé“¾æ¥</button>
        </div>
        <div class="result-box" id="resultBox" style="display: none;">
          <div class="result-label">ç”Ÿæˆçš„ Deep Link:</div>
          <div class="result-url" id="resultUrl"></div>
          <button class="btn btn-secondary" style="margin-top: 12px; padding: 8px 16px; font-size: 0.875rem;" onclick="copyLink()">å¤åˆ¶é“¾æ¥</button>
        </div>
      </div>
      
      <div class="card">
        <h2 class="card-title">å¿«é€Ÿæµ‹è¯•åœºæ™¯</h2>
        <div class="quick-test">
          <button class="quick-test-btn" onclick="quickTest('openrouter', 'sk-or-v1-test123', 'OpenRouteræµ‹è¯•', '')">
            <div class="name">âœ… OpenRouter</div>
            <div class="desc">æ­£å¸¸é…ç½®æµç¨‹</div>
          </button>
          <button class="quick-test-btn" onclick="quickTest('siliconflow', 'sk-sf-test456', 'ç¡…åŸºæµåŠ¨æµ‹è¯•', 'promo2024')">
            <div class="name">âœ… ç¡…åŸºæµåŠ¨ + æ¨å¹¿ç </div>
            <div class="desc">å¸¦æ¨å¹¿ç çš„é…ç½®</div>
          </button>
          <button class="quick-test-btn" onclick="quickTest('unknown-relay', 'sk-unknown', 'æœªçŸ¥ä¸­è½¬', '')">
            <div class="name">âŒ æœªæ³¨å†Œä¸­è½¬å•†</div>
            <div class="desc">æµ‹è¯•é”™è¯¯å¤„ç†</div>
          </button>
          <button class="quick-test-btn" onclick="quickTest('openrouter', '', '', '')">
            <div class="name">âŒ ç¼ºå°‘ Key</div>
            <div class="desc">æµ‹è¯•å‚æ•°æ ¡éªŒ</div>
          </button>
        </div>
      </div>
    </div>

    <!-- Webhook å›è°ƒæµ‹è¯•æ ‡ç­¾é¡µ -->
    <div id="tab-webhook" class="tab-content">
      <div class="card">
        <h2 class="card-title">Webhook å›è°ƒæµ‹è¯•</h2>
        <p style="color: #64748b; margin-bottom: 20px;">æ¨¡æ‹Ÿ ProxyCast å‘é€çš„ç»Ÿè®¡å›è°ƒè¯·æ±‚</p>
        
        <div class="form-row">
          <div class="form-group">
            <label for="callbackUrl">å›è°ƒåœ°å€ (Callback URL) <span class="label-hint">å¿…å¡«</span></label>
            <input type="text" id="callbackUrl" placeholder="https://api.myrelay.com/proxycast/callback">
          </div>
          <div class="form-group">
            <label for="callbackRelay">ä¸­è½¬å•† ID</label>
            <input type="text" id="callbackRelay" placeholder="openrouter" value="openrouter">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="callbackStatus">å›è°ƒçŠ¶æ€</label>
            <select id="callbackStatus">
              <option value="success">âœ… success - é…ç½®æˆåŠŸ</option>
              <option value="cancelled">âš ï¸ cancelled - ç”¨æˆ·å–æ¶ˆ</option>
              <option value="error">âŒ error - é…ç½®å¤±è´¥</option>
            </select>
          </div>
          <div class="form-group">
            <label for="callbackRef">æ¨å¹¿ç  (ref) <span class="label-hint">å¯é€‰</span></label>
            <input type="text" id="callbackRef" placeholder="promo2024" value="promo2024">
          </div>
        </div>
        
        <div class="form-group">
          <label for="callbackKeyPrefix">Key å‰ç¼€ <span class="label-hint">è„±æ•åçš„ Keyï¼ˆå‰ 7 ä½ï¼‰</span></label>
          <input type="text" id="callbackKeyPrefix" placeholder="sk-or-v" value="sk-or-v" maxlength="7">
        </div>
        
        <div class="btn-group">
          <button class="btn btn-primary" onclick="sendCallback()">ğŸ“¤ å‘é€å›è°ƒ</button>
          <button class="btn btn-secondary" onclick="generateCallbackPayload()">ğŸ“‹ ç”Ÿæˆ Payload</button>
          <button class="btn btn-secondary" onclick="clearLogs()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <div class="result-box" id="callbackResultBox" style="display: none;">
          <div class="result-label">å›è°ƒ Payload:</div>
          <pre class="result-url" id="callbackPayload" style="white-space: pre-wrap; font-size: 0.8rem;"></pre>
        </div>
        
        <div style="margin-top: 24px;">
          <div class="result-label">è¯·æ±‚æ—¥å¿—:</div>
          <div class="log-container" id="logContainer">
            <div class="log-entry">
              <span class="time">[--:--:--]</span>
              <span class="type info">INFO</span>
              <span class="message">ç­‰å¾…å‘é€å›è°ƒè¯·æ±‚...</span>
            </div>
          </div>
        </div>
        
        <div class="tips info" style="margin-top: 20px;">
          <div class="tips-title">ğŸ’¡ éªŒè¯è¯´æ˜</div>
          <div class="tips-content">
            ç”±äº ProxyCast æ˜¯å¼€æºè½¯ä»¶ï¼Œä¸ä½¿ç”¨ç­¾åéªŒè¯ã€‚<br>
            ä¸­è½¬å•†åº”é€šè¿‡æ£€æŸ¥ <code>key_prefix</code> æ˜¯å¦ä¸ºè‡ªå·±ä¸‹å‘çš„ Key æ¥éªŒè¯è¯·æ±‚ã€‚
          </div>
        </div>
      </div>
      
      <div class="card">
        <h2 class="card-title">å›è°ƒå­—æ®µè¯´æ˜</h2>
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="border-bottom: 2px solid #e5e7eb;">
              <th style="padding: 12px 0; text-align: left; color: #374151;">å­—æ®µ</th>
              <th style="padding: 12px 0; text-align: left; color: #374151;">è¯´æ˜</th>
            </tr>
          </thead>
          <tbody>
            <tr style="border-bottom: 1px solid #e5e7eb;">
              <td style="padding: 10px 0; font-family: monospace;">status</td>
              <td style="padding: 10px 0;">
                <span class="status-badge success">success</span>
                <span class="status-badge cancelled">cancelled</span>
                <span class="status-badge error">error</span>
              </td>
            </tr>
            <tr style="border-bottom: 1px solid #e5e7eb;">
              <td style="padding: 10px 0; font-family: monospace;">relay_id</td>
              <td style="padding: 10px 0; color: #64748b;">ä¸­è½¬å•† ID</td>
            </tr>
            <tr style="border-bottom: 1px solid #e5e7eb;">
              <td style="padding: 10px 0; font-family: monospace;">key_prefix</td>
              <td style="padding: 10px 0; color: #64748b;">Key å‰ç¼€ï¼ˆè„±æ•ï¼Œä»…å‰ 7 ä½ï¼‰- ç”¨äºéªŒè¯</td>
            </tr>
            <tr style="border-bottom: 1px solid #e5e7eb;">
              <td style="padding: 10px 0; font-family: monospace;">ref</td>
              <td style="padding: 10px 0; color: #64748b;">æ¨å¹¿ç ï¼ˆå¯é€‰ï¼‰</td>
            </tr>
            <tr>
              <td style="padding: 10px 0; font-family: monospace;">client</td>
              <td style="padding: 10px 0; color: #64748b;">å®¢æˆ·ç«¯ä¿¡æ¯ {version, platform}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ä½¿ç”¨è¯´æ˜æ ‡ç­¾é¡µ -->
    <div id="tab-docs" class="tab-content">
      <div class="card">
        <h2 class="card-title">Deep Link åè®®</h2>
        <div style="margin-bottom: 20px;">
          <h3 style="font-size: 1rem; margin-bottom: 12px; color: #374151;">åè®®æ ¼å¼</h3>
          <div class="result-url">proxycast://connect?relay={relay_id}&key={api_key}&name={key_name}&ref={ref_code}</div>
        </div>
        <table style="width: 100%; border-collapse: collapse;">
          <tr style="border-bottom: 1px solid #e5e7eb;">
            <td style="padding: 10px 0; font-weight: 500; font-family: monospace;">relay</td>
            <td style="padding: 10px 0; color: #ef4444; font-weight: 500;">å¿…å¡«</td>
            <td style="padding: 10px 0; color: #64748b;">ä¸­è½¬å•† ID</td>
          </tr>
          <tr style="border-bottom: 1px solid #e5e7eb;">
            <td style="padding: 10px 0; font-weight: 500; font-family: monospace;">key</td>
            <td style="padding: 10px 0; color: #ef4444; font-weight: 500;">å¿…å¡«</td>
            <td style="padding: 10px 0; color: #64748b;">API Key</td>
          </tr>
          <tr style="border-bottom: 1px solid #e5e7eb;">
            <td style="padding: 10px 0; font-weight: 500; font-family: monospace;">name</td>
            <td style="padding: 10px 0; color: #64748b;">å¯é€‰</td>
            <td style="padding: 10px 0; color: #64748b;">Key æ˜¾ç¤ºåç§°</td>
          </tr>
          <tr>
            <td style="padding: 10px 0; font-weight: 500; font-family: monospace;">ref</td>
            <td style="padding: 10px 0; color: #64748b;">å¯é€‰</td>
            <td style="padding: 10px 0; color: #64748b;">æ¨å¹¿ç </td>
          </tr>
        </table>
        <div class="tips">
          <div class="tips-title">ğŸ’¡ æµ‹è¯•å‰æ</div>
          <div class="tips-content">
            1. ç¡®ä¿ ProxyCast åº”ç”¨å·²å®‰è£…å¹¶è¿è¡Œ<br>
            2. ç¡®ä¿ Deep Link åè®®å·²æ­£ç¡®æ³¨å†Œ<br>
            3. å¦‚æœç‚¹å‡»æ— ååº”ï¼Œæ£€æŸ¥æµè§ˆå™¨æ˜¯å¦é˜»æ­¢äº†åè®®è·³è½¬
          </div>
        </div>
      </div>
      
      <div class="card">
        <h2 class="card-title">ç›¸å…³é“¾æ¥</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
          <a href="https://github.com/aiclientproxy/connect" target="_blank" class="quick-test-btn" style="text-decoration: none;">
            <div class="name">ğŸ“¦ ä¸­è½¬å•†æ³¨å†Œä»“åº“</div>
            <div class="desc">æäº¤ PR æ³¨å†Œä¸­è½¬å•†</div>
          </a>
          <a href="https://proxycast.dev/docs/open-platform/connect" target="_blank" class="quick-test-btn" style="text-decoration: none;">
            <div class="name">ğŸ“– Connect æ–‡æ¡£</div>
            <div class="desc">è¯¦ç»†çš„æ¥å…¥æŒ‡å—</div>
          </a>
        </div>
      </div>
    </div>
  </div>
  
  <div class="toast" id="toast"></div>


  <script>
    // Tab åˆ‡æ¢
    function switchTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.add('active');
      document.getElementById(`tab-${tabId}`).classList.add('active');
    }

    // ç”Ÿæˆ Deep Link
    function generateDeepLink() {
      const relay = document.getElementById('relay').value.trim();
      const key = document.getElementById('key').value.trim();
      const name = document.getElementById('name').value.trim();
      const ref = document.getElementById('ref').value.trim();

      if (!relay) { showToast('è¯·è¾“å…¥ä¸­è½¬å•† ID', 'error'); return null; }
      if (!key) { showToast('è¯·è¾“å…¥ API Key', 'error'); return null; }

      let url = `proxycast://connect?relay=${encodeURIComponent(relay)}&key=${encodeURIComponent(key)}`;
      if (name) url += `&name=${encodeURIComponent(name)}`;
      if (ref) url += `&ref=${encodeURIComponent(ref)}`;
      return url;
    }

    // æ‰“å¼€ Deep Link
    function openDeepLink() {
      const url = generateDeepLink();
      if (url) {
        window.location.href = url;
        showToast('æ­£åœ¨æ‰“å¼€ ProxyCast...', 'success');
      }
    }

    // ç”Ÿæˆå¹¶æ˜¾ç¤ºé“¾æ¥
    function generateLink() {
      const url = generateDeepLink();
      if (url) {
        document.getElementById('resultUrl').textContent = url;
        document.getElementById('resultBox').style.display = 'block';
        document.getElementById('resultBox').classList.add('success');
      }
    }

    // å¤åˆ¶é“¾æ¥
    function copyLink() {
      const url = document.getElementById('resultUrl').textContent;
      navigator.clipboard.writeText(url).then(() => {
        showToast('é“¾æ¥å·²å¤åˆ¶', 'success');
      });
    }

    // å¿«é€Ÿæµ‹è¯•
    function quickTest(relay, key, name, ref) {
      document.getElementById('relay').value = relay;
      document.getElementById('key').value = key;
      document.getElementById('name').value = name;
      document.getElementById('ref').value = ref;
      openDeepLink();
    }

    // Toast æç¤º
    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast show ${type}`;
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // æ·»åŠ æ—¥å¿—
    function addLog(type, message) {
      const container = document.getElementById('logContainer');
      const time = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `
        <span class="time">[${time}]</span>
        <span class="type ${type}">${type.toUpperCase()}</span>
        <span class="message">${message}</span>
      `;
      container.appendChild(entry);
      container.scrollTop = container.scrollHeight;
    }

    // æ¸…ç©ºæ—¥å¿—
    function clearLogs() {
      const container = document.getElementById('logContainer');
      container.innerHTML = `
        <div class="log-entry">
          <span class="time">[--:--:--]</span>
          <span class="type info">INFO</span>
          <span class="message">æ—¥å¿—å·²æ¸…ç©º</span>
        </div>
      `;
    }

    // ç”Ÿæˆå›è°ƒ Payload
    function generateCallbackPayload() {
      const payload = buildCallbackPayload();
      if (payload) {
        document.getElementById('callbackPayload').textContent = JSON.stringify(payload, null, 2);
        document.getElementById('callbackResultBox').style.display = 'block';
      }
    }

    // æ„å»ºå›è°ƒ Payload
    function buildCallbackPayload() {
      const relay = document.getElementById('callbackRelay').value.trim();
      const status = document.getElementById('callbackStatus').value;
      const ref = document.getElementById('callbackRef').value.trim();
      const keyPrefix = document.getElementById('callbackKeyPrefix').value.trim();

      if (!relay) { showToast('è¯·è¾“å…¥ä¸­è½¬å•† ID', 'error'); return null; }
      if (!keyPrefix) { showToast('è¯·è¾“å…¥ Key å‰ç¼€', 'error'); return null; }

      const payload = {
        event: 'connect',
        status: status,
        relay_id: relay,
        key_prefix: keyPrefix.substring(0, 7),
        timestamp: new Date().toISOString(),
        client: {
          version: '0.29.0',
          platform: 'web-test'
        }
      };

      if (ref) payload.ref_code = ref;
      if (status === 'error') {
        payload.error_code = 'TEST_ERROR';
        payload.error_message = 'æµ‹è¯•é”™è¯¯æ¶ˆæ¯';
      }

      return payload;
    }

    // å‘é€å›è°ƒ
    async function sendCallback() {
      const url = document.getElementById('callbackUrl').value.trim();
      if (!url) { showToast('è¯·è¾“å…¥å›è°ƒåœ°å€', 'error'); return; }
      if (!url.startsWith('https://')) { showToast('å›è°ƒåœ°å€å¿…é¡»ä½¿ç”¨ HTTPS', 'error'); return; }

      const payload = buildCallbackPayload();
      if (!payload) return;

      addLog('info', `å‘é€å›è°ƒåˆ°: ${url}`);
      addLog('info', `Payload: ${JSON.stringify(payload)}`);

      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'User-Agent': 'ProxyCast/0.29.0 (Test)'
          },
          body: JSON.stringify(payload)
        });

        if (response.ok) {
          addLog('success', `å›è°ƒæˆåŠŸ! HTTP ${response.status}`);
          showToast('å›è°ƒå‘é€æˆåŠŸ', 'success');
        } else {
          addLog('error', `å›è°ƒå¤±è´¥: HTTP ${response.status}`);
          showToast(`å›è°ƒå¤±è´¥: HTTP ${response.status}`, 'error');
        }
      } catch (error) {
        addLog('error', `ç½‘ç»œé”™è¯¯: ${error.message}`);
        showToast('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥å›è°ƒåœ°å€', 'error');
      }
    }
  </script>
</body>
</html>
